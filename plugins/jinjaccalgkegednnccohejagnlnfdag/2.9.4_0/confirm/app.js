webpackJsonp([5],{118:function(a,b,c){"use strict";var d=c(96),e=c.n(d),f=c(0),g=c(2),h=c(87),i=c(102),j=c(16),k=c(63),l=Object(h.a)({});b.a={components:{Dropdown:e.a,VmCode:i.a,SettingCheck:j.a},data(){return{installable:!1,dependencyOK:!1,closeAfterInstall:g.a.get("closeAfterInstall"),message:"",code:"",commands:{close:this.close},info:{}}},computed:{isLocal(){return!Object(f.k)(this.info.url)}},mounted(){var a=this;this.message=this.i18n("msgLoadingData"),this.loadInfo().then(function(){var b=k.a.paths[0];a.guard=setInterval(function(){Object(f.p)({cmd:"CacheHit",data:{key:`confirm-${b}`}})},5e3)},function(){return a.close(),Promise.reject()}).then(this.loadData).then(this.parseMeta)},beforeDestroy(){this.guard&&(clearInterval(this.guard),this.guard=null)},methods:{loadInfo(){var a=this,b=k.a.paths[0];return Object(f.p)({cmd:"CacheLoad",data:`confirm-${b}`}).then(function(b){return b?void(a.info=b):Promise.reject()})},loadData(a){var b=this;this.installable=!1;var c=this.code;return this.getScript(this.info.url).then(function(d){return a&&c===d?Promise.reject():void(b.code=d)})},parseMeta(){var a=this;return Object(f.p)({cmd:"ParseMeta",data:this.code}).then(function(b){var c=Object.keys(b.resources).map(function(a){return b.resources[a]}),d=b.require.length+c.length;if(d){var e=0,g=[],h=function(){a.message=a.i18n("msgLoadingDependency",[e,d])};h(),a.require={},a.resources={};var i=b.require.map(function(b){var c=Object(f.e)(b,a.info.url);return a.getFile(c,{useCache:!0}).then(function(b){a.require[c]=b})}).concat(c.map(function(b){var c=Object(f.e)(b,a.info.url);return a.getFile(c,{isBlob:!0,useCache:!0}).then(function(b){a.resources[c]=b})})).map(function(a){return a.then(function(){e+=1,h()},function(a){g.push(a)})});return Promise.all(i).then(function(){return g.length?Promise.reject(g.join("\n")):void(a.dependencyOK=!0)})}}).then(function(){a.message=a.i18n("msgLoadedData"),a.installable=!0},function(b){return a.message=a.i18n("msgErrorLoadingDependency",[b]),Promise.reject()})},close(){Object(f.p)({cmd:"TabClose"})},getFile(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=b.isBlob,d=b.useCache,e=c?`blob+${a}`:`text+${a}`;return d&&l.has(e)?Promise.resolve(l.get(e)):Object(f.o)(a,{responseType:c?"arraybuffer":null}).then(function(a){var b=a.data;return c?window.btoa(Object(f.a)(b)):b}).then(function(a){return d&&l.put(e,a),a})},getScript(a){var b=this;return Object(f.p)({cmd:"CacheLoad",data:a}).then(function(a){return a||Promise.reject()}).catch(function(){return b.getFile(a)}).catch(function(){throw b.message=b.i18n("msgErrorLoadingData"),a})},getTimeString(){var a=new Date;return`${Object(f.l)(a.getHours(),2)}:${Object(f.l)(a.getMinutes(),2)}:${Object(f.l)(a.getSeconds(),2)}`},installScript(){var a=this;this.installable=!1,Object(f.p)({cmd:"ParseScript",data:{code:this.code,url:this.info.url,from:this.info.from,require:this.require,resources:this.resources}}).then(function(b){a.message=`${b.update.message}[${a.getTimeString()}]`,a.closeAfterInstall?a.close():a.isLocal&&g.a.get("trackLocalFile")&&a.trackLocalFile()})},trackLocalFile(){var a=this;new Promise(function(a){setTimeout(a,2e3)}).then(function(){return a.loadData(!0)}).then(this.parseMeta).then(function(){var b=g.a.get("trackLocalFile");b&&a.installScript()},function(){a.trackLocalFile()})},checkClose(a){this.closeAfterInstall=a,a&&g.a.set("trackLocalFile",!1)}}}},310:function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(21),e=c(36),f=c(0),g=c(61),h=c(2),i=c(62),j=c(311),k=c(314),l=c.n(k);e["default"].prototype.i18n=f.i,document.title=`${Object(f.i)("labelInstall")} - ${Object(f.i)("extName")}`,h.a.ready(function(){new e["default"]({render:function(a){return a(j.a)}}).$mount("#app")})},311:function(a,b,c){"use strict";var d=c(118),e=c(313),f=c(1),g=Object(f.a)(d.a,e.a,e.b,!1,function(){c(312)},null,null);b.a=g.exports},312:function(){},313:function(a,b,c){"use strict";c.d(b,"a",function(){return d}),c.d(b,"b",function(){return e});var d=function(){var a=this,b=a.$createElement,c=a._self._c||b;return c("div",{staticClass:"page-confirm frame flex flex-col h-100"},[c("div",{staticClass:"frame-block"},[c("div",{staticClass:"buttons pull-right"},[c("dropdown",{staticClass:"confirm-options",attrs:{align:"right"}},[c("button",{attrs:{slot:"toggle"},domProps:{textContent:a._s(a.i18n("buttonInstallOptions"))},slot:"toggle"}),c("label",[c("setting-check",{attrs:{name:"closeAfterInstall"},on:{change:a.checkClose}}),c("span",{domProps:{textContent:a._s(a.i18n("installOptionClose"))}})],1),c("label",[c("setting-check",{attrs:{name:"trackLocalFile",disabled:a.closeAfterInstall}}),c("span",{domProps:{textContent:a._s(a.i18n("installOptionTrack"))}})],1)]),c("button",{attrs:{disabled:!a.installable},domProps:{textContent:a._s(a.i18n("buttonConfirmInstallation"))},on:{click:a.installScript}}),c("button",{domProps:{textContent:a._s(a.i18n("buttonClose"))},on:{click:a.close}})],1),c("h1",[c("span",{domProps:{textContent:a._s(a.i18n("labelInstall"))}}),a._v(" - "),c("span",{domProps:{textContent:a._s(a.i18n("extName"))}})]),c("div",{staticClass:"ellipsis confirm-url",attrs:{title:a.info.url},domProps:{textContent:a._s(a.info.url)}}),c("div",{staticClass:"ellipsis confirm-msg",domProps:{textContent:a._s(a.message)}})]),c("div",{staticClass:"frame-block flex-auto pos-rel"},[c("vm-code",{staticClass:"abs-full",attrs:{readonly:"",value:a.code,commands:a.commands}})],1)])},e=[]},314:function(){}},[310]);