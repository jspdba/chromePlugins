webpackJsonp([2],{121:function(e,t,a){"use strict";function s(){Object(f.s)("lastUpdate",Date.now()),Object(y.i)().then(function(e){var t=e.filter(function(e){return Object(u.a)(e,"config.shouldUpdate")});return Promise.all(t.map(f.c))}).then(function(e){e.some(Boolean)&&h.e()})}function i(){function e(){new Promise(function(e,t){return Object(f.h)("autoUpdate")?void(864e5<=Date.now()-Object(f.h)("lastUpdate")&&e(s())):t()}).then(function(){return setTimeout(e,36e5)},function(){x=!1})}x||(x=!0,e())}function r(e){var t=M[e];if(t){var a,s=Object(f.h)("showBadge");"total"===s?a=t.number:s&&(a=t.unique),_.setBadgeText({text:`${a||""}`,tabId:e})}}function o(){browser.tabs.query({}).then(function(e){e.forEach(function(e){r(e.id)})})}function n(e){_.setIcon({path:{19:`/public/images/icon19${e?"":"w"}.png`,38:`/public/images/icon38${e?"":"w"}.png`}})}Object.defineProperty(t,"__esModule",{value:!0});var d=a(12),c=a.n(d),p=a(21),l=a(0),u=a(6),h=a(186),f=a(13),m=a(219),g=a(220),y=a(34),b=a(88),k=a(221),v=browser.runtime.getManifest().version,_=["setIcon","setBadgeText","setBadgeBackgroundColor"].reduce(function(e,t){var a=browser.browserAction[t];return e[t]=a?a.bind(browser.browserAction):l.m,e},{});Object(f.j)(function(e){"isApplied"in e&&n(e.isApplied),"autoUpdate"in e&&i(),"showBadge"in e&&o(),Object(f.q)({cmd:"UpdateOptions",data:e})});var x=void 0,S={NewScript(){return Object(f.n)()},RemoveScript(e){return Object(y.n)(e).then(function(){h.e()})},GetData(e){return(e?Object(y.a)():Promise.resolve()).then(y.d).then(function(e){return e.sync=h.b(),e.version=v,e})},GetInjected(e,t){var a=e.url,s=e.reset,i=t.tab||{};s&&i.id&&Object(k.b)(i.id);var r={isApplied:Object(f.h)("isApplied"),version:v};return r.isApplied?Object(y.j)(a).then(function(e){return Object(k.a)(i.id,Object.keys(e.values)),Object.assign(r,e)}):r},UpdateScriptInfo(e){var t=e.id,a=e.config;return Object(y.p)(t,{config:a,props:{lastModified:Date.now()}}).then(function(e){var t=c()(e,1),a=t[0];h.e(),Object(f.q)({cmd:"UpdateScript",data:{where:{id:a.props.id},update:a}})})},GetValueStore(e){return Object(y.k)([e]).then(function(t){return t[e]||{}})},SetValueStore(e){var t=e.where,a=e.valueStore;return Object(k.c)(t,a)},UpdateValue(e){var t=e.id,a=e.update;return Object(k.d)(t,a)},ExportZip(e){var t=e.ids,a=e.values;return Object(y.e)(t,a)},GetScriptCode(e){return Object(y.h)(e)},GetMetas(e){return Object(y.g)(e)},Move(e){var t=e.id,a=e.offset;return Object(y.l)(t,a).then(function(){h.e()})},Vacuum:y.q,ParseScript(e){return Object(y.m)(e).then(function(e){return Object(f.q)(e),h.e(),e.data})},CheckUpdate(e){Object(y.f)({id:e}).then(f.c).then(function(e){e&&h.e()})},CheckUpdateAll:s,ParseMeta(e){return Object(f.p)(e)},GetRequestId:f.i,HttpRequest(e,t){Object(f.k)(e,function(e){browser.tabs.sendMessage(t.tab.id,{cmd:"HttpRequested",data:e}).catch(l.m)})},AbortRequest:f.a,SetBadge:function(e,t){var a=e.ids,s=e.reset,i=t.tab||{},o=!s&&M[i.id];o||(o={number:0,unique:0,idMap:{}},M[i.id]=o),o.number+=a.length,a&&(a.forEach(function(e){o.idMap[e]=1}),o.unique=Object.keys(o.idMap).length),_.setBadgeBackgroundColor({color:"#808",tabId:i.id}),r(i.id)},SyncAuthorize:h.a,SyncRevoke:h.d,SyncStart:h.e,CacheLoad(e){return f.b.get(e)||null},CacheHit(e){f.b.hit(e.key,e.lifetime)},Notification:g.a,SetClipboard:f.r,TabOpen:m.b,TabClose:m.a,GetAllOptions:f.f,GetOptions(e){return e.reduce(function(e,t){return e[t]=Object(f.h)(t),e},{})},SetOptions(e){var t=Array.isArray(e)?e:[e];t.forEach(function(e){Object(f.s)(e.key,e.value)})},ConfirmInstall:f.d,CheckScript(e){var t=e.name,a=e.namespace;return Object(y.f)({meta:{name:t,namespace:a}}).then(function(e){return e?e.meta.version:null})},CheckPosition(){return Object(y.o)()}};Object(f.l)().then(function(){browser.runtime.onMessage.addListener(function(e,t){var a,s=S[e.cmd];return s&&(a=s(e.data,t),"undefined"!=typeof a&&(a=Promise.resolve(a).then(function(e){return{data:e}},function(e){return!1,{error:e}}))),a||null}),setTimeout(i,2e4),h.c(),Object(b.a)(),Object(y.a)()});var M={};browser.tabs.onRemoved.addListener(function(e){delete M[e]}),n(Object(f.h)("isApplied"))},13:function(e,t,a){"use strict";t.o=function(e){browser.notifications.create(e.id||"ViolentMonkey",{type:"basic",iconUrl:s.d,title:`${e.title} - ${Object(s.i)("extName")}`,message:e.body,isClickable:e.isClickable})},t.q=function(){var e;return(e=browser.runtime).sendMessage.apply(e,arguments).catch(s.m)};var s=a(0),i=a(58);a.d(t,"b",function(){return i.a});var r=a(194);a.d(t,"r",function(){return r.a});var o=a(195);a.d(t,"c",function(){return o.a});var n=a(213);a.d(t,"g",function(){return n.a});var d=a(24);a.d(t,"n",function(){return d.d}),a.d(t,"p",function(){return d.e});var c=a(35);a.d(t,"f",function(){return c.a}),a.d(t,"h",function(){return c.b}),a.d(t,"j",function(){return c.c}),a.d(t,"s",function(){return c.d});var p=a(214);a.d(t,"a",function(){return p.a}),a.d(t,"d",function(){return p.b}),a.d(t,"i",function(){return p.c}),a.d(t,"k",function(){return p.d});var l=a(215);a.d(t,"e",function(){return l.a}),a.d(t,"m",function(){return l.b});var u=a(59);a.d(t,"l",function(){return u.a})},186:function(e,t,a){"use strict";var s=a(33),i=a(216),r=a(217),o=a(218);a.d(t,"c",function(){return s.g}),a.d(t,"e",function(){return s.k}),a.d(t,"b",function(){return s.e}),a.d(t,"a",function(){return s.b}),a.d(t,"d",function(){return s.j}),browser.tabs.onUpdated.addListener(function(e,t){t.url&&Object(s.c)(t.url)&&browser.tabs.remove(e)})},194:function(e,t){"use strict";function a(t){t.preventDefault();var e=i,a=e.type,s=e.data;t.clipboardData.setData(a||"text/plain",s)}t.a=function(e){i=e,s.focus();var t=document.execCommand("copy",!1,null)};var s=document.createElement("textarea");document.body.appendChild(s);var i=void 0;document.addEventListener("copy",a,!1)},195:function(e,t,a){"use strict";function s(e){var t={checking:!0},a={cmd:"UpdateScript",data:{where:{id:e.props.id},update:t}},s=e.custom.downloadURL||e.meta.downloadURL||e.custom.lastInstallURL,r=e.custom.updateURL||e.meta.updateURL||s;return r?(t.message=Object(i.i)("msgCheckingForUpdate"),Object(d.q)(a),Object(i.o)(r,{headers:{Accept:"text/x-userscript-meta"}}).then(function(s){var r=s.data,n=Object(o.e)(r);return 0>Object(o.a)(e.meta.version,n.version)?Promise.resolve():(t.checking=!1,t.message=Object(i.i)("msgNoUpdate"),Object(d.q)(a),Promise.reject())},function(){return t.checking=!1,t.message=Object(i.i)("msgErrorFetchingUpdateInfo"),Object(d.q)(a),Promise.reject()}).then(function(){return s?(t.message=Object(i.i)("msgUpdating"),Object(d.q)(a),Object(i.o)(s).then(function(e){var t=e.data;return t},function(){return t.checking=!1,t.message=Object(i.i)("msgErrorFetchingScript"),Object(d.q)(a),Promise.reject()})):(t.message=`<span class="new">${Object(i.i)("msgNewVersion")}</span>`,Object(d.q)(a),Promise.reject())})):Promise.reject()}t.a=function(e){var t=e.props.id,a=c[t];if(!a){var o=!1;a=s(e).then(function(e){return Object(r.m)({id:t,code:e})}).then(function(e){var t=e.data.update;t.checking=!1,Object(d.q)(e),o=!0,Object(n.b)("notifyUpdates")&&Object(d.o)({title:Object(i.i)("titleScriptUpdated"),body:Object(i.i)("msgScriptUpdated",[t.meta.name||Object(i.i)("labelNoName")])})}).catch(function(){}).then(function(){return delete c[t],o}),c[t]=a}return a};var i=a(0),r=a(34),o=a(24),n=a(35),d=a(13),c={}},212:function(e,t,a){"use strict";var s=a(24);t.a=function(){return new Promise(function(e,t){function a(t){var a=t.transaction(["scripts","require","cache","values"]),s={},d=3,c=function(){d-=1,d||e(browser.storage.local.set(s))};i(a,function(e){var t={};e.forEach(function(e){var a=e.script,i=e.code;s[`scr:${a.props.id}`]=a,s[`code:${a.props.id}`]=i,t[a.props.uri]=a.props.id}),n(a,function(e){e.forEach(function(e){var t=e.id,a=e.values;s[`val:${t}`]=a}),c()},t)}),r(a,function(e){e.forEach(function(e){var t=e.uri,a=e.data;s[`cac:${t}`]=a}),c()}),o(a,function(e){e.forEach(function(e){var t=e.uri,a=e.code;s[`req:${t}`]=a}),c()})}function i(e,a){var s=e.objectStore("scripts"),i=[],r=s.openCursor();r.onsuccess=function(t){var e=t.target.result;if(e){var s=e.value;i.push(d(s)),e.continue()}else a(i)},r.onerror=t}function r(e,a){var s=e.objectStore("cache"),i=[],r=s.openCursor();r.onsuccess=function(t){var e=t.target.result;if(e){var s=e.value,r=s.uri,o=s.data;i.push({uri:r,data:o}),e.continue()}else a(i)},r.onerror=t}function o(e,a){var s=e.objectStore("require"),i=[],r=s.openCursor();r.onsuccess=function(t){var e=t.target.result;if(e){var s=e.value,r=s.uri,o=s.code;i.push({uri:r,code:o}),e.continue()}else a(i)},r.onerror=t}function n(e,a,s){var i=e.objectStore("values"),r=[],o=i.openCursor();o.onsuccess=function(t){var e=t.target.result;if(e){var i=e.value,o=i.uri,n=i.values,d=s[o];d&&r.push({id:d,values:n}),e.continue()}else a(r)},o.onerror=t}function d(e){var t={script:{meta:Object(s.e)(e.code),custom:Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},e.custom),props:{id:e.id,uri:e.uri,position:e.position},config:{enabled:e.enabled,shouldUpdate:e.update}},code:e.code};return t}console.info("Upgrade database..."),function(){var e=indexedDB.open("Violentmonkey",1);e.onsuccess=function(){a(e.result)},e.onerror=t,e.onupgradeneeded=function(){t()}}()}).catch(function(){})}},213:function(e,t){"use strict";t.a=function(){var e={};return{on:function(t,a){var s=e[t];s||(s=[],e[t]=s),s.push(a)},off:function(t,a){var s=e[t];if(s){var r=s.indexOf(a);0<=r&&s.splice(r,1)}},fire:function(t,a){var s=e[t];s&&s.forEach(function(e){e(a,t)})}}}},214:function(e,t,a){"use strict";function s(e){var t=Promise.resolve(),a=e.xhr;return function(s){var r={id:e.id,type:s.type,resType:a.responseType},o={finalUrl:a.responseURL,readyState:a.readyState,responseHeaders:a.getAllResponseHeaders(),status:a.status,statusText:a.statusText};r.data=o;try{o.responseText=a.responseText}catch(t){}"progress"===s.type&&["lengthComputable","loaded","total"].forEach(function(e){o[e]=s[e]}),"loadend"===s.type&&i(e),t=t.then(function(){if(a.response&&"arraybuffer"===a.responseType){var e=a.getResponseHeader("Content-Type")||"application/octet-stream",t=Object(c.a)(a.response);o.response=`data:${e};base64,${window.btoa(t)}`}else o.response=a.response}).then(function(){e.cb&&e.cb(r)})}}function i(e){e.coreId&&delete h[e.coreId],delete u[e.id]}function r(e){var t=e.cls,a=e.value;if("formdata"===t){var s=new FormData;return a&&Object.keys(a).forEach(function(e){a[e].forEach(function(t){s.append(e,r(t))})}),s}if(["blob","file"].includes(t)){for(var o=e.type,n=e.name,d=e.lastModified,c=new Uint8Array(a.length),p=0;p<a.length;p+=1)c[p]=a.charCodeAt(p);var i=[c.buffer];return"file"===t?new File(i,n,{type:o,lastModified:d}):new Blob(i,{type:o})}return a?JSON.parse(a):void 0}function o(e){return(e.code?Promise.resolve(e.code):Object(c.o)(e.url).then(function(e){var t=e.data;return Object(l.c)(t)?t:Promise.reject(Object(c.i)("msgInvalidScript"))})).then(function(t){p.a.put(e.url,t,3e3);var a=Object(c.h)();p.a.put(`confirm-${a}`,{url:e.url,from:e.from});var s=browser.runtime.getURL("/confirm/index.html");browser.tabs.create({url:`${s}#${a}`})})}t.c=function(){var e=Object(c.h)();return u[e]={id:e,xhr:new XMLHttpRequest},e},t.d=function(e,t){var a=u[e.id];if(a&&!a.cb){a.cb=t;var i=a.xhr;try{i.open(e.method,e.url,!0,e.user||"",e.password||""),i.setRequestHeader("VM-Verify",e.id),e.headers&&Object.keys(e.headers).forEach(function(t){var a=t.toLowerCase();a.startsWith("vm-")||i.setRequestHeader(f.includes(a)?`VM-${t}`:t,e.headers[t])}),e.responseType&&(i.responseType="arraybuffer"),e.overrideMimeType&&i.overrideMimeType(e.overrideMimeType);var o=s(a);["abort","error","load","loadend","progress","readystatechange","timeout"].forEach(function(e){i[`on${e}`]=o});var n=e.data,d=n?r(n):null;i.send(d)}catch(t){console.warn(t)}}},t.a=function(e){var t=u[e];t&&(t.xhr.abort(),i(t))},t.b=o;var n=a(12),d=a.n(n),c=a(0),p=a(58),l=a(24),u={},h={},f=["user-agent","referer","origin","host","cookie"];browser.webRequest.onBeforeSendHeaders.addListener(function(e){var t=e.requestHeaders,a=[],s={};t.forEach(function(e){e.name.startsWith("VM-")?s[e.name.slice(3)]=e.value:a.push(e)});var i=s.Verify;if(i){var r=u[i];r&&(delete s.Verify,h[e.requestId]=i,r.coreId=e.requestId,Object.keys(s).forEach(function(e){f.includes(e.toLowerCase())&&a.push({name:e,value:s[e]})}))}return{requestHeaders:a}},{urls:["<all_urls>"],types:["xmlhttprequest"]},["blocking","requestHeaders"]);var m=/\.user\.js([?#]|$)/,g=["^https://greasyfork.org/scripts/[^/]*/code/[^/]*?\\.user\\.js([?#]|$)","^https://openuserjs.org/install/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://github.com/[^/]*/[^/]*/raw/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://gist.github.com/.*?/[^/]*?.user.js([?#]|$)"].map(function(e){return new RegExp(e)}),y=["//(?:(?:gist.|)github.com|greasyfork.org|openuserjs.org)/"].map(function(e){return new RegExp(e)}),b={};browser.webRequest.onBeforeRequest.addListener(function(e){var t=e.url;if("GET"===e.method&&m.test(t)&&!b[t]&&(g.some(function(e){return e.test(t)})||!y.some(function(e){return e.test(t)})))return Promise.all([Object(c.o)(t).catch(function(){return{data:""}}),0>e.tabId?Promise.resolve():browser.tabs.get(e.tabId)]).then(function(e){var a=d()(e,2),s=a[0].data,i=a[1],r=Object(l.e)(s);r.name?o({code:s,url:t,from:i&&i.url}):(!b[t]&&(b[t]={timer:setTimeout(function(){delete b[t]},1e4)}),i&&i.id&&browser.tabs.update(i.id,{url:t}))}),{redirectUrl:"javascript:history.back()"}},{urls:["<all_urls>"],types:["main_frame"]},["blocking"])},215:function(e,t){"use strict";t.b=function(e){return e.split("&").reduce(function(e,t){var a=t.split("=");return e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]),e},{})},t.a=function(e){return Object.keys(e).map(function(t){return`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`}).join("&")}},216:function(e,t,a){"use strict";function s(e){return{size:e.size,uri:Object(r.f)(e.name)}}var i=a(13),r=a(33),o={client_id:"f0q12zup2uys5w8",redirect_uri:"https://violentmonkey.github.io/auth_dropbox.html"},n=r.a.extend({name:"dropbox",displayName:"Dropbox",user(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"}).catch(function(e){return 401===e.status?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})})},handleMetaError(e){if(409===e.status)return{};throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then(function(e){return e.entries.filter(function(e){return"file"===e[".tag"]&&Object(r.h)(e.name)}).map(s)})},get(e){var t=Object(r.d)(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":JSON.stringify({path:`/${t}`})}})},put(e,t){var a=Object(r.d)(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":JSON.stringify({path:`/${a}`,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(s)},remove(e){var t=Object(r.d)(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:`/${t}`},responseType:"json"}).then(s)},authorize(){var e={response_type:"token",client_id:o.client_id,redirect_uri:o.redirect_uri},t=`https://www.dropbox.com/oauth2/authorize?${Object(i.e)(e)}`;browser.tabs.create({url:t})},authorized(e){var t=Object(i.m)(e);t.access_token&&this.config.set({uid:t.uid,token:t.access_token})},checkAuth(e){var t=`${o.redirect_uri}#`;if(e.startsWith(t))return this.authorized(e.slice(t.length)),this.checkSync(),!0},revoke(){return this.config.set({uid:null,token:null}),this.prepare()}});Object(r.i)(n)},217:function(e,t,a){"use strict";function s(e){return{size:e.size,uri:Object(n.f)(e.name)}}var i=a(0),r=a(6),o=a(13),n=a(33),d=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0Ijoiajl4M09WRXRIdmhpSEtEV09HcXV5TWZaS2s5NjA0MEgifQ==")),c=Object.assign({client_id:"000000004418358A",redirect_uri:"https://violentmonkey.github.io/auth_onedrive.html"},d),p=n.a.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){var e=this,t=this.config.get("refresh_token");return this.authorized({refresh_token:t,grant_type:"refresh_token"}).then(function(){return e.prepare()})},user(){var e=this,t=function(){return e.loadData({url:"/drive",responseType:"json"})};return t().catch(function(a){if(401===a.status)return e.refreshToken().then(t);throw a}).catch(function(e){return 400===e.status&&"invalid_grant"===Object(r.a)(e,"data.error")?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})})},handleMetaError(e){var t=this;if(404===e.status){var a=e.xhr.getResponseHeader("WWW-Authenticate")||"";return /^Bearer realm="OneDriveAPI"/.test(a)?this.refreshToken().then(function(){return t.getMeta()}):{}}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then(function(e){return e.value.filter(function(e){return e.file&&Object(n.h)(e.name)}).map(s)})},get(e){var t=this,a=Object(n.d)(e);return this.loadData({url:`/drive/special/approot:/${encodeURIComponent(a)}`,responseType:"json"}).then(function(e){return t.loadData({url:e["@content.downloadUrl"],delay:!1})})},put(e,t){var a=Object(n.d)(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(a)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(s)},remove(e){var t=Object(n.d)(e);return this.loadData({method:"DELETE",url:`/drive/special/approot:/${encodeURIComponent(t)}`}).catch(i.m)},authorize(){var e={client_id:c.client_id,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:c.redirect_uri},t=`https://login.live.com/oauth20_authorize.srf?${Object(o.e)(e)}`;browser.tabs.create({url:t})},checkAuth(e){var t=this,a=`${c.redirect_uri}?code=`;if(e.startsWith(a))return this.authState.set("authorizing"),this.authorized({code:e.slice(a.length)}).then(function(){return t.checkSync()}),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object(o.e)(Object.assign({},{client_id:c.client_id,client_secret:c.client_secret,redirect_uri:c.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(function(e){if(e.access_token)t.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token});else throw e})}});Object(n.i)(p)},218:function(e,t,a){"use strict";function s(e){return{id:e.id,size:+e.size,uri:Object(n.f)(e.name)}}var i=a(0),r=a(6),o=a(13),n=a(33),d=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0IjoiTjBEbTZJOEV3bkJaeE1xMUpuMHN3UER0In0=")),c=Object.assign({client_id:"590447512361-05hjbhnf8ua3iha55e5pgqg15om0cpef.apps.googleusercontent.com",redirect_uri:"https://violentmonkey.github.io/auth_googledrive.html",scope:"https://www.googleapis.com/auth/drive.appdata"},d),p={status:"UNAUTHORIZED"},l=n.a.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){var e=this,t=this.config.get("refresh_token");return t?this.authorized({refresh_token:t,grant_type:"refresh_token"}).then(function(){return e.prepare()}):Promise.reject({type:"unauthorized"})},user(){var e=this,t=function(){return e.loadData({url:`https://www.googleapis.com/oauth2/v3/tokeninfo?${Object(o.e)({access_token:e.config.get("token")})}`,responseType:"json"})};return t().then(function(t){return"online"===t.access_type?e.loadData({method:"POST",url:`https://accounts.google.com/o/oauth2/revoke?token=${e.config.get("token")}`,prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return Object(o.o)({title:"Sync Upgraded",body:"Please reauthorize access to your Google Drive to complete the upgradation."}),Promise.reject("Online access revoked.")}):t.scope===c.scope?void 0:Promise.reject(p)}).catch(function(a){return a===p||400===a.status&&"Invalid Value"===Object(r.a)(a,"data.error_description")?e.refreshToken().then(t):Promise.reject({type:"error",data:a})})},getSyncData(){var e=this;return this.loadData({url:`/files?${Object(o.e)({spaces:"appDataFolder",fields:"files(id,name,size)"})}`,responseType:"json"}).then(function(t){var a,i=t.files,r=i.filter(function(t){return!!Object(n.h)(t.name)||(a||t.name!==e.metaFile?e.remove(t):a=t,!1)}).map(s).filter(function(t){return!!t.size||(e.remove(t),!1)}),o=a?s(a):{},d=e.get(o).then(function(e){return JSON.parse(e)}).catch(function(t){return e.handleMetaError(t)}).then(function(t){return Object.assign({},o,{data:t,uri:null,name:e.metaFile})});return Promise.all([d,r,e.getLocalData()])})},authorize(){var e={response_type:"code",access_type:"offline",client_id:c.client_id,redirect_uri:c.redirect_uri,scope:c.scope};this.config.get("refresh_token")||(e.prompt="consent");var t=`https://accounts.google.com/o/oauth2/v2/auth?${Object(o.e)(e)}`;browser.tabs.create({url:t})},checkAuth(e){var t=this,a=`${c.redirect_uri}?code=`;if(e.startsWith(a))return this.authState.set("authorizing"),this.authorized({code:e.split("#")[0].slice(a.length)}).then(function(){return t.checkSync()}),!0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object(o.e)(Object.assign({},{client_id:c.client_id,client_secret:c.client_secret,redirect_uri:c.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(function(e){if(e.access_token){var a={token:e.access_token};e.refresh_token&&(a.refresh_token=e.refresh_token),t.config.set(a)}else throw e})},handleMetaError(){return{}},list(){throw new Error("Not supported")},get(e){var t=e.id;return t?this.loadData({url:`/files/${t}?alt=media`}):Promise.reject()},put(e,t){var a=Object(n.d)(e),s=e.id,r=Object(i.h)("violentmonkey-is-great-"),o={"Content-Type":`multipart/related; boundary=${r}`},d=s?{name:a}:{name:a,parents:["appDataFolder"]},c=[`--${r}`,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(d),`--${r}`,"Content-Type: text/plain","",t,`--${r}--`,""].join("\r\n"),p=s?`https://www.googleapis.com/upload/drive/v3/files/${s}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:p,body:c,headers:o,method:s?"PATCH":"POST"})},remove(e){var t=e.id;return this.loadData({method:"DELETE",url:`/files/${t}`})}});Object(n.i)(l)},219:function(e,t,a){"use strict";t.b=function(e,t){var a=e.url,s=e.active,o=t.tab||{},n={url:a,active:s,windowId:o.windowId,index:o.index+1};return i.b&&i.a||(n.openerTabId=o.id),browser.tabs.create(n).then(function(e){var t=e.id;return r[t]=o.id,{id:t}})},t.a=function(e,t){var a=e&&e.id||t.tab&&t.tab.id;a&&browser.tabs.remove(a)};var s=a(0),i=a(60),r={};browser.tabs.onRemoved.addListener(function(e){var t=r[e];t&&(browser.tabs.sendMessage(t,{cmd:"TabClosed",data:e}).catch(s.m),delete r[e])})},220:function(e,t,a){"use strict";t.a=function(e,t){var a=t.tab||{};return browser.notifications.create({type:"basic",title:e.title||Object(s.i)("extName"),message:e.text,iconUrl:e.image||s.d}).then(function(e){return i[e]=a.id,e})};var s=a(0),i={};browser.notifications.onClicked.addListener(function(e){var t=i[e];t&&browser.tabs.sendMessage(t,{cmd:"NotificationClick",data:e}).catch(s.m)}),browser.notifications.onClosed.addListener(function(e){var t=i[e];t&&(browser.tabs.sendMessage(t,{cmd:"NotificationClose",data:e}).catch(s.m),delete i[e])})},221:function(e,t,a){"use strict";function s(e,t){r();var a=t.key,s=t.value;u||(u={});var i=u[e];i||(i={},u[e]=i),i[a]=s||null}function i(e){var t=l[e];t&&(Object.keys(t).forEach(function(t){var a=p[t];a&&delete a[e]}),delete l[e])}function r(){h||(h=Promise.resolve().then(o))}function o(){var e=u;u=null;var t=Object.keys(e);Object(c.k)(t).then(function(a){return t.forEach(function(t){var s=a[t]||{};a[t]=s;var i=e[t]||{};Object.keys(i).forEach(function(e){var t=i[e];t?s[e]=t:delete s[e]})}),Object(c.c)(a)}).then(n).then(function(){h=null,u&&r()})}function n(e){if(e){var t=Object.keys(e).reduce(function(e,t){return Object.assign(e,p[t])},{});Object.keys(t).forEach(function(t){browser.tabs.sendMessage(+t,{cmd:"UpdatedValues",data:e}).catch(d.m)})}}t.d=s,t.c=function(e,t){return Object(c.b)(e,t).then(n)},t.b=i,t.a=function(e,t){var a=l[e];a||(a={},l[e]=a),t.forEach(function(t){a[t]=1;var s=p[t];s||(s={},p[t]=s),s[e]=1})};var d=a(0),c=a(34),p={},l={},u=void 0,h=void 0;browser.tabs.onRemoved.addListener(function(e){i(e)})},24:function(e,t,a){"use strict";function s(e){var t=Object.keys(p).reduce(function(e,t){return Object.assign(e,{[t]:p[t].default()})},{}),a=-1;return e.replace(/(?:^|\n)\/\/\s*([@=]\S+)(.*)/g,function(e,s,i){if(0>a&&s===o?a=1:0<a&&s===n&&(a=0),1==a&&"@"===s[0]){var d=s.slice(1).split(":"),l=r()(d,2),u=l[0],h=l[1],f=u.replace(/[-_](\w)/g,function(e,t){return t.toUpperCase()}),m=h?`${f}:${h.toLowerCase()}`:f,g=i.trim(),y=p[m]||c,b=t[m];"undefined"==typeof b&&(b=y.default()),t[m]=y.transform(b,g)}}),t.resources=t.resource,delete t.resource,!t.homepageURL&&t.homepage&&(t.homepageURL=t.homepage),t}t.c=function(e){return!/^\s*</.test(e)&&!(0>e.indexOf(o))},t.e=s,t.d=function(){var e=`\
// ==UserScript==
// @name New Script
// @namespace Violentmonkey Scripts
// @match *://*/*
// @grant none
// ==/UserScript==
`,t={custom:{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},config:{enabled:1,shouldUpdate:1},meta:s(e)};return{script:t,code:e}},t.b=function(e){var t=e.meta.namespace||"",a=e.meta.name||"",s=`${escape(t)}:${escape(a)}:`;return t||a||(s+=e.props.id||""),s},t.a=function(e,t){for(var a,s=(e||"").split("."),r=(t||"").split("."),o=0;o<s.length||o<r.length;o+=1)if(a=(parseInt(s[o],10)||0)-(parseInt(r[o],10)||0),a)return 0>a?-1:1;return 0};var i=a(12),r=a.n(i),o="==UserScript==",n="==/UserScript==",d={default:function(){return[]},transform:function(e,t){return e.push(t),e}},c={default:function(){return null},transform:function(e,t){return null==e?t:e}},p={include:d,exclude:d,match:d,excludeMatch:d,require:d,resource:{default:function(){return{}},transform:function(e,t){var a=t.match(/^(\w\S*)\s+(.*)/);return a&&(e[a[1]]=a[2]),e}},grant:d,noframes:{default:function(){return!1},transform:function(){return!0}}}},33:function(e,t,a){"use strict";function s(e){return`vm-${encodeURIComponent(e)}`}function i(){function e(e,t){var a=Object(_.n)(e);a.unshift("sync"),Object(S.s)(a,t)}return function(){var t=Object(S.h)("sync");t&&t.services||(t={services:{}},e([],t))}(),{get:function(e,t){var a=Object(_.n)(e);return a.unshift("sync"),Object(S.h)(a,t)},set:e}}function r(e){function t(t){var a=Object(_.n)(t);return a.unshift("services",e),a}function a(e,a){return I.get(t(e),a)}function s(e,a){if("object"==typeof e){var s=e;Object.keys(s).forEach(function(e){I.set(t(e),s[e])})}else I.set(t(e),a)}function i(){I.set(t(),{})}return{get:a,set:s,clear:i}}function o(e,t,a){function s(){return r}function i(e){var t=Array.isArray(e)?e:[e];return t.includes(r)}var r=t||e[0];return{get:s,set:function(t){return e.includes(t)?(r=t,a&&a()):console.warn("Invalid state:",t),s()},is:i}}function n(){return E.map(function(e){var t=U[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress}})}function d(e,t,a){var s;return 2===t?s={version:t,custom:e.custom,config:e.config,props:Object(x.b)(e.props,["lastUpdated"])}:1==t&&(s={version:t,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}}),Object.assign(s,a)}function c(e){var t={};try{var a=JSON.parse(e);t.code=a.code,2===a.version?(t.config=a.config,t.custom=a.custom,t.props=a.props):1===a.version&&a.more&&(t.custom=a.more.custom,t.config=Object(x.c)({enabled:a.more.enabled,shouldUpdate:a.more.update}),t.props=Object(x.c)({lastUpdated:a.more.lastUpdated}))}catch(a){t.code=e}return t}function p(e){var t=function(){this.initialize()};return t.prototype=e,t.extend=l,t}function l(e){return p(Object.assign(Object.create(this.prototype),e))}function u(){return I.get("current")}function h(e){return U[e||u()]}function f(){I||(I=i(),j.forEach(function(e){var t=new e,a=t.name;E.push(a),U[a]=t}));var e=h();e&&e.checkSync()}function m(e){return e.syncState.is(["ready","syncing"])?void 0:e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0}function g(){var e=h();return e&&Promise.resolve(m(e)).then(T)}t.d=function(e){var t=e.name,a=e.uri;return a?s(a):t},t.h=function(e){return /^vm-/.test(e)},t.f=function(e){return decodeURIComponent(e.slice(3))},t.e=n,a.d(t,"a",function(){return R}),t.i=function(e){j.push(e)},t.g=f,t.k=g,t.c=function(e){return E.some(function(t){var a=U[t],s=a.checkAuth&&a.checkAuth(e);return s})},t.b=function(){var e=h();e&&e.authorize()},t.j=function(){var e=h();e&&e.revoke()};var y=a(57),b=a.n(y),k=a(12),v=a.n(k),_=a(0),x=a(6),S=a(13),M=a(34),E=[],j=[],U={},T=Object(_.c)(g,3600000),w=Promise.resolve(),I=void 0,q=Object(_.c)(function(){Object(S.q)({cmd:"UpdateSync",data:n()})}),R=p({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:"Violentmonkey",initialize(){var e=this;this.progress={finished:0,total:0},this.config=r(this.name),this.authState=o(["idle","initializing","authorizing","authorized","unauthorized","error"],null,q),this.syncState=o(["idle","ready","syncing","error"],null,q),this.lastFetch=Promise.resolve(),this.startSync=this.syncFactory();var t=Object(S.g)();["on","off","fire"].forEach(function(a){e[a]=function(){t[a].apply(t,arguments)}})},log(){var e;(e=console).log.apply(e,arguments)},syncFactory(){function e(){return t||r(),a&&a(),t}var t,a,s=this,i=function(){return s.authState.is("authorized")&&u()===s.name},r=function(){return i()?void(s.log("Ready to sync:",s.displayName),s.syncState.set("ready"),w=w.then(function(){return new Promise(function(e){a=Object(_.c)(e,10000),a()})}).then(function(){return i()?s.sync():void s.syncState.set("idle")}).catch(function(e){console.error(e)}).then(function(){t=null,a=null}),t=w):Promise.resolve()};return e},prepareHeaders(){this.headers={}},prepare(){var e=this;return this.authState.set("initializing"),(this.initToken()?Promise.resolve(this.user()):Promise.reject({type:"unauthorized"})).then(function(){e.authState.set("authorized")},function(t){throw t&&"unauthorized"===t.type?e.authState.set("unauthorized"):(console.error(t),e.authState.set("error")),e.syncState.set("idle"),t})},checkSync(){var e=this;return this.prepare().then(function(){return e.startSync()})},user:_.m,handleMetaError(e){throw e},getMeta(){var e=this;return this.get({name:this.metaFile}).then(function(e){return JSON.parse(e)}).catch(function(t){return e.handleMetaError(t)})},initToken(){this.prepareHeaders();var e=this.config.get("token");return this.headers.Authorization=e?`Bearer ${e}`:null,!!e},loadData(e){var t=this,a=this.progress,s=e.delay;null==s&&(s=this.delayTime);var i=Promise.resolve();return s&&(i=this.lastFetch.then(function(e){return new Promise(function(t){var a=s-(Date.now()-e);0<a?setTimeout(t,a):t()})}).then(function(){return Date.now()}),this.lastFetch=i),a.total+=1,q(),i.then(function(){var a=e.prefix;null==a&&(a=t.urlPrefix);var s=Object.assign({},t.headers,e.headers),i=e.url;return i.startsWith("/")&&(i=a+i),Object(_.o)(i,{headers:s,method:e.method,body:e.body,responseType:e.responseType})}).then(function(e){var t=e.data;return{data:t}},function(e){return{error:e}}).then(function(e){var t=e.data,s=e.error;return a.finished+=1,q(),s?Promise.reject(s):t})},getLocalData(){return Object(M.i)()},getSyncData(){var e=this;return this.getMeta().then(function(t){return Promise.all([{name:e.metaFile,data:t},e.list(),e.getLocalData()])})},sync(){var e=this;return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then(function(){return e.getSyncData()}).then(function(t){var a=v()(t,3),s=a[0],i=a[1],r=a[2],o=s.data,n=o.info||{},p=o.timestamp||0,l=!p||Object.keys(n).length!==i.length,u=Date.now(),h=Object(S.h)("lastModified"),f={},m=e.config.get("meta",{}),g=!m.timestamp,y=g||p>m.timestamp;e.log("First sync:",g),e.log("Outdated:",y,"(","local:",m.timestamp,"remote:",p,")");var k=[],E=[],j=[],U=[],T=[];o.info=i.reduce(function(e,t){f[t.uri]=t;var a=n[t.uri];return a||(a={},l=!0),e[t.uri]=a,a.modified||(a.modified=u,l=!0),e},{}),r.forEach(function(e){var t=e.props,a=t.uri,s=t.position,i=t.lastModified,r=o.info[a];if(r){var n=f[a];g||!i||r.modified>i?k.push({local:e,remote:n,info:r}):(r.modified<i&&(E.push({local:e,remote:n}),r.modified=i,l=!0),r.position!==s&&(r.position&&h<=p?T.push({local:e,remote:n,info:r}):(r.position=s,l=!0))),delete f[a]}else g||!y||i>p?E.push({local:e}):U.push({local:e})}),Object.keys(f).forEach(function(e){var t=f[e],a=o.info[e];y?k.push({remote:t,info:a}):j.push({remote:t})});var w=[].concat(b()(k.map(function(t){var a=t.remote,s=t.info;return e.log("Download script:",a.uri),e.get(a).then(function(e){var t=c(e);if(t.code){s.modified&&Object(x.d)(t,"props.lastModified",s.modified);var a=+s.position;return a&&(t.position=a),!Object(S.h)("syncScriptStatus")&&t.config&&delete t.config.enabled,Object(M.m)(t).then(function(e){Object(S.q)(e)})}})})),b()(E.map(function(t){var a=t.local,s=t.remote;return e.log("Upload script:",a.props.uri),Object(M.h)(a.props.id).then(function(t){var i=d(a,1,{code:t});return o.info[a.props.uri]={modified:a.props.lastModified,position:a.props.position},l=!0,e.put(Object.assign({},s,{uri:a.props.uri}),JSON.stringify(i))})})),b()(j.map(function(t){var a=t.remote;return e.log("Remove remote script:",a.uri),delete o.info[a.uri],l=!0,e.remove(a)})),b()(U.map(function(t){var a=t.local;return e.log("Remove local script:",a.props.uri),Object(M.n)(a.props.id)})),b()(T.map(function(e){var t=e.local,a=e.info,s={};return a.position&&(s.props={position:a.position}),Object(M.p)(t.props.id,s)})));return w.push(Promise.all(w).then(function(){return Object(M.o)()}).then(function(e){if(e)return l=!0,Object(M.i)().then(function(e){e.forEach(function(e){var t=o.info[e.props.uri];t&&(t.position=e.props.position)})})})),w.push(Promise.all(w).then(function(){var t=[];return l&&(o.timestamp=Date.now(),t.push(e.put(s,JSON.stringify(o)))),m.timestamp=o.timestamp,m.lastSync=Date.now(),e.config.set("meta",m),Promise.all(t)})),Promise.all(w.map(function(e){return e.then(_.m,function(e){return e||!0})})).then(function(e){return e.filter(Boolean)}).then(function(e){if(e.length)throw e})}).then(function(){e.syncState.set("idle")},function(t){e.syncState.set("error"),e.log("Failed syncing:",e.name),e.log(t)})}});Object(S.j)(function(e){var t=Object(x.a)(e,"sync.current");t&&f()})},34:function(e,t,a){"use strict";function s(e){var t={};return function(a){var s=t[a];if(!s){for(var i=arguments.length,r=Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];s=e.call.apply(e,[this,a].concat(r)).catch(function(e){console.error(`Error fetching: ${a}`,e)}).then(function(){delete t[a]}),t[a]=s}return s}}function i(e){return+e||0}function r(){Object(E.d)("lastModified",Date.now())}function o(){var e=[],t="props.position";U.scripts.forEach(function(a,s){var i=s+1;Object(v.a)(a,t)!==i&&(Object(v.d)(a,t,i),e.push(a)),"undefined"==typeof a.custom.origInclude&&(a.custom=Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},a.custom),!e.includes(a)&&e.push(a))}),U.storeInfo.position=U.scripts.length;var a=e.length;return a?T.script.dump(e).then(function(){return r(),a}):Promise.resolve()}function n(){return U.scripts.sort(function(e,t){var a=[e,t].map(function(e){return i(Object(v.a)(e,"props.position"))}),s=k()(a,2),r=s[0],o=s[1];return r-o}),o().then(function(e){return Object(j.q)({cmd:"ScriptsUpdated"}),e})}function d(e){var t;if(e.id)t=U.scriptMap[e.id];else{var a=e.uri||Object(_.b)({meta:e.meta,id:"@@should-have-name"}),s=function(e){return a===Object(v.a)(e,"props.uri")};t=U.scripts.find(s)}return Promise.resolve(t)}function c(e){return!1,T.value.dump(e).then(function(){return e})}function p(e){var t=(e+280880802).toString(16).slice(-8);return`${t}-${Object(b.g)()}-${Object(b.g)()}-${Object(b.g)()}-${Object(b.g)()}${Object(b.g)()}${Object(b.g)()}`}function l(e,t){var a=e.config||{};a.enabled=i(a.enabled),a.shouldUpdate=i(a.shouldUpdate);var s,r=e.props||{};if(r.id?s=U.scriptMap[r.id]:(U.storeInfo.id+=1,r.id=U.storeInfo.id),r.uri=Object(_.b)(e),r.uuid=r.uuid||p(r.id),U.scripts.some(function(e){var t=e.props||{};return r.id!==t.id&&r.uri===t.uri}))throw Object(b.i)("msgNamespaceConflict");if(s){e.config=Object.assign({},s.config,a),e.props=Object.assign({},s.props,r);var o=U.scripts.indexOf(s);U.scripts[o]=e}else r.position?U.storeInfo.position<r.position&&(U.storeInfo.position=r.position):(U.storeInfo.position+=1,r.position=U.storeInfo.position),e.config=a,e.props=r,U.scripts.push(e);return Promise.all([T.script.dump(e),T.code.set(r.id,t)])}function u(e){var t=e.meta,a=e.custom.lastInstallURL,s={};return[].concat(g()(t.require),g()(Object.values(t.resources)),[Object(b.k)(t.icon)&&t.icon]).forEach(function(e){if(e){var t=Object(b.e)(e,a);t!==e&&(s[e]=t)}}),e.custom.pathMap=s,s}function h(e,t){var a=e.meta,s=e.custom.pathMap;if(a.require.forEach(function(e){var a=s[e]||e,i=Object(v.a)(t,["require",a]);i?T.require.set(a,i):T.require.fetch(a)}),Object.values(a.resources).forEach(function(e){var a=s[e]||e,i=Object(v.a)(t,["resources",a]);i?T.cache.set(a,i):T.cache.fetch(a)}),Object(b.k)(a.icon)){var i=s[a.icon]||a.icon;T.cache.fetch(i,function(e){var t=e.blob;return new Promise(function(e,a){var s=t(),i=URL.createObjectURL(s),r=new Image,o=function(){return URL.revokeObjectURL(i)};r.onload=function(){o(),e()},r.onerror=function(){o(),a({type:"IMAGE_ERROR",url:i})},r.src=i})})}}var f=Math.max;t.o=n,t.f=d,t.i=function(){return Promise.resolve(U.scripts).then(function(e){return e.filter(function(e){return!e.config.removed})})},t.g=function(e){return Promise.all(e.map(function(e){return d({id:e})})).then(function(e){return e.filter(Boolean)})},t.h=function(e){return T.code.getOne(e)},t.k=function(e){return T.value.getMulti(e)},t.c=c,t.b=function(e,t){return(e.id?Promise.resolve(e.id):d(e).then(function(e){return Object(v.a)(e,"props.id")})).then(function(e){if(e)return c({[e]:t})})},t.j=function(e){var t=Object(x.b)(e)?[]:U.scripts.filter(function(t){return!t.config.removed&&Object(x.c)(e,t)}),a={},s={};t.forEach(function(e){if(e.config.enabled){e.custom.pathMap||u(e);var t=e.custom.pathMap;e.meta.require.forEach(function(e){a[t[e]||e]=1}),Object.values(e.meta.resources).forEach(function(e){s[t[e]||e]=1})}});var i=t.filter(function(e){return e.config.enabled}),r={GM_getValue:1,GM_setValue:1,GM_listValues:1,GM_deleteValue:1},o=i.filter(function(e){var t=Object(v.a)(e,"meta.grant");return t&&t.some(function(e){return r[e]})});return Promise.all([T.require.getMulti(Object.keys(a)),T.cache.getMulti(Object.keys(s)),T.value.getMulti(o.map(function(e){return e.props.id}),{}),T.code.getMulti(i.map(function(e){return e.props.id}))]).then(function(e){var a=k()(e,4),s=a[0],i=a[1],r=a[2],o=a[3];return{scripts:t,require:s,cache:i,values:r,code:o}})},t.d=function(){var e={},t=U.scripts;return t.forEach(function(t){var a=Object(v.a)(t,"meta.icon");if(Object(b.k)(a)){var s=Object(v.a)(t,"custom.pathMap")||{},i=s[a]||a;e[i]=1}}),T.cache.getMulti(Object.keys(e)).then(function(e){return{scripts:t,cache:e}})},t.a=function(){var e=U.scripts.filter(function(e){return e.config.removed});if(e.length){U.scripts=U.scripts.filter(function(e){return!e.config.removed});var t=e.map(function(e){return e.props.id});T.script.removeMulti(t),T.code.removeMulti(t),T.value.removeMulti(t)}return Promise.resolve(e.length)},t.n=function(e){var t=U.scripts.findIndex(function(t){return e===Object(v.a)(t,"props.id")});return 0<=t&&(U.scripts.splice(t,1),T.script.remove(e),T.code.remove(e),T.value.remove(e)),Object(j.q)({cmd:"RemoveScript",data:e}),Promise.resolve()},t.l=function(e,t){var a=U.scripts.findIndex(function(t){return e===Object(v.a)(t,"props.id")}),s=0<t?1:-1,i=a,r=a+t,n=Math.min(i,r),d=f(i,r),c=U.scripts.slice(n,d+1);return 0<s?c.push(c.shift()):c.unshift(c.pop()),U.scripts=[].concat(g()(U.scripts.slice(0,n)),g()(c),g()(U.scripts.slice(d+1))),o()},t.p=function(e,t){var a=U.scriptMap[e];return a?(a.props=Object.assign({},a.props,t.props),a.config=Object.assign({},a.config,t.config),T.script.dump(a)):Promise.reject()},t.e=function(e,t){var a=e.filter(function(e){var t=U.scriptMap[e];return t&&!t.config.removed});return Promise.all([Promise.all(a.map(function(e){return d({id:e})})),T.code.getMulti(a)]).then(function(a){var s=k()(a,2),i=s[0],r=s[1],o={};return o.items=i.map(function(e){return{script:e,code:r[e.props.id]}}),t?T.value.getMulti(e).then(function(e){return o.values=e,o}):o})},t.m=function(e){var t=e.id,a=e.code,s=e.message,i=e.isNew,r=e.config,o=e.custom,n=e.props,c=Object(_.e)(a);if(!c.name)return Promise.reject(Object(b.i)("msgInvalidScript"));var p={cmd:"UpdateScript",data:{update:{message:null==s?Object(b.i)("msgUpdated"):s||""}}};return d({id:t,meta:c}).then(function(t){var s;if(t){if(i)throw Object(b.i)("msgNamespaceConflict");s=Object.assign({},t)}else{var d=Object(_.d)();s=d.script,p.cmd="AddScript",p.data.update.message=Object(b.i)("msgInstalled")}s.config=Object.assign({},s.config,r,{removed:0}),s.custom=Object.assign({},s.custom,o),s.props=Object.assign({},s.props,{lastModified:Date.now(),lastUpdated:Date.now()},n),s.meta=c,c.homepageURL||s.custom.homepageURL||!Object(b.k)(e.from)||(s.custom.homepageURL=e.from),Object(b.k)(e.url)&&(s.custom.lastInstallURL=e.url);var h=+e.position;return h&&Object(v.d)(s,"props.position",h),u(s),l(s,a).then(function(){return s})}).then(function(t){return h(t,e),Object.assign(p.data.update,t),p.data.where={id:t.props.id},p})},t.q=function(){var e={},t={},a={},s={},i=[[T.value,e],[T.cache,t],[T.require,a],[T.code,s]];return browser.storage.local.get().then(function(r){Object.keys(r).forEach(function(e){i.some(function(t){var a=k()(t,2),s=a[0],i=a[1],r=s.prefix;return!!e.startsWith(r)&&(i[e.slice(r.length)]=-1,!0)})});var o=function(e,t){0>e[t]?e[t]=1:!e[t]&&(e[t]=2)};U.scripts.forEach(function(i){var r=i.props.id;o(s,r),o(e,r),i.custom.pathMap||u(i);var n=i.custom.pathMap;i.meta.require.forEach(function(e){o(a,n[e]||e)}),Object.values(i.meta.resources).forEach(function(e){o(t,n[e]||e)});var d=i.meta.icon;if(Object(b.k)(d)){var c=n[d]||d;o(t,c)}}),i.forEach(function(e){var t=k()(e,2),a=t[0],s=t[1];Object.keys(s).forEach(function(e){var t=s[e];0>t?a.remove(e):2===t&&a.fetch&&a.fetch(e)})})})};var m=a(57),g=a.n(m),y=a(12),k=a.n(y),b=a(0),v=a(6),_=a(24),x=a(88),S=a(59),M=a(212),E=a(35),j=a(13),U={},T={base:{prefix:"",getKey(e){return`${this.prefix}${e}`},getOne(e){var t=this.getKey(e);return browser.storage.local.get(t).then(function(e){return e[t]})},getMulti(e,t){var a=this;return browser.storage.local.get(e.map(function(e){return a.getKey(e)})).then(function(s){var i={};return e.forEach(function(e){i[e]=s[a.getKey(e)]||t}),i})},set(e,t){return e?browser.storage.local.set({[this.getKey(e)]:t}):Promise.resolve()},remove(e){return e?browser.storage.local.remove(this.getKey(e)):Promise.resolve()},removeMulti(e){var t=this;return browser.storage.local.remove(e.map(function(e){return t.getKey(e)}))}}};T.script=Object.assign({},T.base,{prefix:"scr:",dump:function(e){return function(t){var a=Array.isArray(t)?t:[t];return a=a.filter(Boolean),a.length?e.call(this,a):Promise.resolve()}}(function(e){var t=this,a={};return e.forEach(function(e){a[t.getKey(e.props.id)]=e,U.scriptMap[e.props.id]=e}),browser.storage.local.set(a).then(function(){return e})})}),T.code=Object.assign({},T.base,{prefix:"code:"}),T.value=Object.assign({},T.base,{prefix:"val:",dump(e){var t=this,a={};return Object.keys(e).forEach(function(s){var i=e[s];a[t.getKey(s)]=i}),browser.storage.local.set(a)}}),T.require=Object.assign({},T.base,{prefix:"req:",fetch:s(function(e){var t=this;return Object(b.o)(e).then(function(a){var s=a.data;return t.set(e,s)})})}),T.cache=Object.assign({},T.base,{prefix:"cac:",fetch:s(function(e,t){var a=this;return Object(b.o)(e,{responseType:"arraybuffer"}).then(function(s){var i=s.data,r=s.xhr,o=(r.getResponseHeader("content-type")||"").split(";")[0],n={contentType:o,buffer:i,blob:function(e){return new Blob([i],Object.assign({type:o},e))},string:function(){return Object(b.a)(i)},base64:function(){return window.btoa(n.string())}};return(t?Promise.resolve(t(n)):Promise.resolve()).then(function(){return a.set(e,`${o},${n.base64()}`)})})})}),Object(S.b)(function(){return browser.storage.local.get("version").then(function(e){var t=e.version,a=browser.runtime.getManifest(),s=a.version;return(t?Promise.resolve():Object(M.a)()).then(function(){if(s!==t)return browser.storage.local.set({version:s})})}).then(function(){return browser.storage.local.get()}).then(function(e){var t=[],a={id:0,position:0};return Object.keys(e).forEach(function(s){var r=e[s];s.startsWith("scr:")&&(t.push(r),a.id=f(a.id,i(Object(v.a)(r,"props.id"))),a.position=f(a.position,i(Object(v.a)(r,"props.position"))))}),Object.assign(U,{scripts:t,storeInfo:a,scriptMap:t.reduce(function(e,t){return e[t.props.id]=t,e},{})}),!1,n()})}())},35:function(e,t,a){"use strict";function s(e,t){Object(d.d)(l,e,t),h()}function i(){u.fire(l),l={}}function r(e,t){var a=Object(n.n)(e),s=a[0],i=f[s];return null==i&&(i=p[s]),null==i&&(i=t),1<a.length?Object(d.a)(i,a.slice(1),t):i}function o(e,t){if(!m)return void g.then(function(){o(e,t)});var a=Object(n.n)(e),i=a.join("."),c=t,l=a[0];l in p&&(1<a.length&&(c=Object(d.d)(r(l),a.slice(1),t)),f[l]=c,browser.storage.local.set({options:f}),s(a,t),!1)}t.b=r,t.d=o,t.a=function(){return Object.keys(p).reduce(function(e,t){return e[t]=r(t),e},{})},a.d(t,"c",function(){return y});var n=a(0),d=a(6),c=a(59),p={isApplied:!0,autoUpdate:!0,lastUpdate:0,lastModified:0,showBadge:"unique",exportValues:!0,closeAfterInstall:!1,trackLocalFile:!1,autoReload:!1,features:null,blacklist:null,syncScriptStatus:!0,sync:null,customCSS:null,importSettings:!0,notifyUpdates:!1,version:null,filters:{sort:"exec"},editor:{lineWrapping:!1,indentUnit:2}},l={},u=Object(n.j)(),h=Object(n.c)(i,100),f={},m=!1,g=browser.storage.local.get("options").then(function(e){var t=e.options;if(t&&"object"==typeof t&&(f=t),!1,!Object(d.a)(f,"version")){try{localStorage.length&&Object.keys(p).forEach(function(e){var t=localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(a){t=null}t&&(!1,o(e,t))})}catch(t){}o("version",1)}}).then(function(){m=!0});Object(c.b)(g);var y=u.hook},58:function(e,t,a){"use strict";var s=a(87);t.a=Object(s.a)({lifetime:10000})},59:function(e,t){"use strict";t.b=function(e){a.push(e)},t.a=function(){return Promise.all(a.map(function(e){return"function"==typeof e?e():e})).then(function(){})};var a=[]},88:function(e,t,a){"use strict";function s(e,t){var a=60000;return t.some(function(t){var s=`re:${t}`,i=g.a.get(s);return i?g.a.hit(s,a):(i=n(t),g.a.put(s,i,a)),i.test(e)})}function i(e,t){var a=60000;return t.some(function(t){var s=`match:${t}`,i=g.a.get(s);return i?g.a.hit(s,a):(i=l(t),g.a.put(s,i,a)),i.test(e)})}function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.reduce(function(e,t){return t?e.concat(t):e},[])}function o(e){var t=e.replace(/([.?+[\]{}()|^$])/g,"\\$1").replace(/\*/g,".*?");return`^${t}$`}function n(e){if(1<e.length&&"/"===e[0]&&"/"===e[e.length-1])return new RegExp(e.slice(1,-1));var t=o(e),a=new RegExp(t),s=[function(e){return a.test(e)}];if(m.d()&&e.includes(".tld/")){var i=t.replace("\\.tld/","((?:\\.\\w+)+)/");s.push(function(e){var t=e.match(i);if(t){var a=t[1].slice(1);if(m.b(a)===a)return!0}return!1})}return{test:function(e){return s.some(function(t){return t(e)})}}}function d(e,t){return e===t?1:"*"===e&&v.test(t)?1:0}function c(e){var t=new RegExp(o(e));return function(a){if("*"===e)return 1;if(e===a)return 1;if(/^\*\.[^*]*$/.test(e)){if(e.slice(2)===a)return 1;if(t.test(a))return 1}return 0}}function p(e){var t=new RegExp(o(e));return function(e){return t.test(e)}}function l(e){var t;if("<all_urls>"===e)t=function(){return!0};else{var a=e.match(b);if(a){var s=c(a[2]),i=p(a[3]);t=function(e){var t=e.match(b);return!!a&&!!t&&d(a[1],t[1])&&s(t[2])&&i(t[3])}}else t=function(){return!1}}return{test:t}}function u(e,t){if(t.startsWith(e))return t.slice(e.length).trim()}function h(e){for(var t=0;t<k.length;t+=1){var a=k[t],s=a.test,i=a.reject;if(s(e))return i}}function f(e){var t=null==e?Object(y.b)("blacklist"):e;!1,k=(Array.isArray(t)?t:(t||"").split("\n")).map(function(e){var t=e.trim();if(!t||t.startsWith("#"))return null;var a=u("@include ",t);if(a)return{test:n(a).test,reject:!1};var s=u("@match ",t);if(s)return{test:l(s).test,reject:!1};var i=u("@exclude ",t);return i?{test:n(i).test,reject:!0}:0>t.indexOf("/")?{test:l(`*://${t}/*`).test,reject:!0}:{test:l(t).test,reject:!0}}).filter(Boolean)}t.c=function(e,t){var a=t.custom,o=t.meta,n=r(a.origMatch&&o.match,a.match),d=r(a.origInclude&&o.include,a.include),c=r(a.origExclude&&o.exclude,a.exclude),p=r(a.origExcludeMatch&&o.excludeMatch,a.excludeMatch),l=!n.length&&!d.length;return l=l||i(e,n),l=l||s(e,d),l=l&&!i(e,p),l=l&&!s(e,c),l},t.b=h,t.a=f;var m=a(89),g=a(58),y=a(35);m.c(!0);var b=/(.*?):\/\/([^/]*)\/(.*)/,k=[];Object(y.c)(function(e){"blacklist"in e&&f(e.blacklist||"")});var v=/^https?$/i}},[121]);